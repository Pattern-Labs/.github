name: 'Pattern CLI Setup'
description: 'Setup Pattern CLI'
inputs:
  repo_access_pat:
    description: 'GitHub Personal Access Token'
    required: true
    type: string
runs:
  using: "composite"
  steps:
    - name: Checkout dev-containers repo
      uses: actions/checkout@v3
      with:
        repository: Pattern-Labs/dev-containers
        token: ${{ inputs.repo_access_pat }}
        path: dev-containers
        ref: main

    - name: Run gcloud env_module
      working-directory: ./dev-containers
      shell: bash
      run: sudo env_modules/99-google_cloud.sh

    - name: Install Pattern CLI
      working-directory: ./dev-containers
      shell: bash
      run: ./install_pattern_cli.sh

    - name: Setup Host
      working-directory: ./dev-containers
      shell: bash
      run: ./setup_host.sh -q

    - name: Test Pattern CLI
      shell: bash 
      run: pattern version

    - name: Initialize Clusters
      shell: bash
      run: pattern clusters init      